# Quest 1.5: Real-Time Data Display

## Status: Approved

## Quest

\* As a user,  
\* I want to see a live, read-only list of all my automations on the dashboard,  
\* so that I can monitor their status at a glance.

## Acceptance Criteria (ACs)

1\.  On loading the dashboard, the data grid fetches and displays all

```text
 automations from the database.

```text

2\.  The status badge for each automation is displayed with the correct color

```text
 based on the \`status\` field from the database.

```text

3\.  The grid utilizes a real-time subscription (e.g., via Supabase

```text
 Realtime) to update rows instantly when their corresponding data changes
 in the database, without requiring a page refresh.

```text

4\.  The "Last Run" and "Avg Duration" columns display human-readable,

```text
 formatted data (e.g., "5 minutes ago", "3.2 seconds").

```text

## Tasks / Subtasks

\- \[ \] Create the \`GET /api/automations\` API route.  
\- \[ \] Implement the API route's logic to call a new function in the

```text
   \`Repository Layer\` that fetches all automations associated with the
   authenticated user's client.

```text

\- \[ \] Modify the \`AutomationsDataTable\` component to remove the static

```text
   mock data and accept real data as props.

```text

\- \[ \] Implement a client-side data fetching hook (e.g., \`useAutomations\`)

```text
   that calls the \`GET /api/automations\` endpoint on initial component
   mount.

```text

\- \[ \] Connect the data from the hook to the \`AutomationsDataTable\`

```text
   component to display the initial list.

```text

\- \[ \] Implement the Supabase Realtime subscription within the React

```text
   component or hook to listen for changes (inserts, updates) on the
   \`automations\` table.

```text

\- \[ \] Implement the logic to update the local state when a real-time event

```text
   is received, causing the UI to re-render with the new data.

```text

\- \[ \] Create and apply utility functions to format the \`last\_run\_at\`

```text
   and \`avg\_duration\_ms\` data for display.

```text

## Dev Notes

\_ \_\_Prerequisite:\_\* This quest requires Quests 1.2 (Auth), 1.3
  (Telemetry Endpoint), and 1.4 (DB Schema & UI Grid) to be complete.
\_ \_\_Architecture:\_\* This is the capstone quest for Journey 1\. The data
  flow is: the Backend API fetches the initial data list, and the Supabase
  Realtime subscription provides all subsequent updates directly to the
  client. Do not use manual polling.
\_ \_\_UI:\_\* To improve user experience, consider adding a subtle highlight
  animation to a row that has just been updated via the real-time subscription
  to gently draw the user's attention to the change.

## Testing

This quest requires \_\_Integration and End-to-End Tests\_\_.

\_ \_\_Integration Tests (Vitest):\_\*  

```text
\* Test the \`GET /api/automations\` endpoint to ensure it correctly
  returns data and enforces security (a user from Client A should not be
  able to see data from Client B).
\* Test the frontend data fetching hook (\`useAutomations\`) by mocking
  the API response.

```text

\_ \_\_E2E Tests (Playwright):\_\*  

```text
\* Update the E2E tests to log in and verify that a list of mock
  automations (seeded in the test database) is correctly displayed in
  the grid.

```text

## Manual Test Steps  

1\.  Manually add 2-3 sample automations to your local Supabase database for

```text
 a specific client.

```text

2\.  Log in to the application as a user associated with that client.
3\.  Verify that the data grid on the dashboard correctly displays the

```text
 automations you added.

```text

4\.  While keeping the dashboard open in your browser, go to the Supabase

```text
 Studio (dashboard) and manually change the \`status\` of one of the
 automations (e.g., from 'Stopped' to 'Running').

```text

5\.  Verify that the status badge for that automation in your web app

```text
 updates automatically within a few seconds without you having to refresh
 the page.

```text
